name: Build Android APK

on:
  push:
      branches: [ "main" ]
        pull_request:
            branches: [ "main" ]
              workflow_dispatch:

              jobs:
                build:
                    runs-on: ubuntu-latest

                            steps:
                                - name: Checkout code
                                      uses: actions/checkout@v4

                                                - name: Set up JDK 17
                                                      uses: actions/setup-java@v4
                                                            with:
                                                                    java-version: '17'
                                                                            distribution: 'temurin'

                                                                                        - name: Setup Android SDK
                                                                                              uses: android-actions/setup-android@v3
                                                                                                    
                                                                                                        - name: Create missing files
                                                                                                              run: |
                                                                                                                      mkdir -p app/src/main/res/values
                                                                                                                              mkdir -p app/src/main/res/drawable
                                                                                                                                      mkdir -p app/src/main/res/xml
                                                                                                                                              mkdir -p app/src/main/res/mipmap-hdpi
                                                                                                                                                      
                                                                                                                                                              # Create strings.xml
                                                                                                                                                                      cat > app/src/main/res/values/strings.xml << 'EOF'
                                                                                                                                                                              <?xml version="1.0" encoding="utf-8"?>
                                                                                                                                                                                      <resources>
                                                                                                                                                                                                  <string name="app_name">抖音视频下载器</string>
                                                                                                                                                                                                          </resources>
                                                                                                                                                                                                                  EOF
                                                                                                                                                                                                                          
                                                                                                                                                                                                                                  # Create colors.xml
                                                                                                                                                                                                                                          cat > app/src/main/res/values/colors.xml << 'EOF'
                                                                                                                                                                                                                                                  <?xml version="1.0" encoding="utf-8"?>
                                                                                                                                                                                                                                                          <resources>
                                                                                                                                                                                                                                                                      <color name="primary_color">#FF6200EE</color>
                                                                                                                                                                                                                                                                                  <color name="background_color">#FFFFFF</color>
                                                                                                                                                                                                                                                                                              <color name="text_color">#000000</color>
                                                                                                                                                                                                                                                                                                          <color name="secondary_text_color">#666666</color>
                                                                                                                                                                                                                                                                                                                      <color name="warning_color">#FF9800</color>
                                                                                                                                                                                                                                                                                                                                  <color name="warning_background">#FFF3E0</color>
                                                                                                                                                                                                                                                                                                                                          </resources>
                                                                                                                                                                                                                                                                                                                                                  EOF
                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                  # Create themes.xml
                                                                                                                                                                                                                                                                                                                                                                          cat > app/src/main/res/values/themes.xml << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                  <?xml version="1.0" encoding="utf-8"?>
                                                                                                                                                                                                                                                                                                                                                                                          <resources>
                                                                                                                                                                                                                                                                                                                                                                                                      <style name="Theme.TikTokDownloader" parent="Theme.Material3.DayNight">
                                                                                                                                                                                                                                                                                                                                                                                                                      <item name="colorPrimary">@color/primary_color</item>
                                                                                                                                                                                                                                                                                                                                                                                                                                  </style>
                                                                                                                                                                                                                                                                                                                                                                                                                                          </resources>
                                                                                                                                                                                                                                                                                                                                                                                                                                                  EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  # Create ic_tiktok.xml
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cat > app/src/main/res/drawable/ic_tiktok.xml << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <vector xmlns:android="http://schemas.android.com/apk/res/android"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              android:width="24dp"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          android:height="24dp"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      android:viewportWidth="24"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  android:viewportHeight="24">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <path
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              android:fillColor="#FF000000"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              android:pathData="M12,2C6.48,2 2,6.48 2,12s4.48,10 10,10 10,-4.48 10,-10S17.52,2 12,2z"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </vector>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              # Create file_paths.xml
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cat > app/src/main/res/xml/file_paths.xml << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?xml version="1.0" encoding="utf-8"?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <paths>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <external-path name="external_files" path="."/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </paths>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  # Create simple launcher icon
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cp app/src/main/res/drawable/ic_tiktok.xml app/src/main/res/mipmap-hdpi/ic_launcher.xml
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cp app/src/main/res/drawable/ic_tiktok.xml app/src/main/res/mipmap-hdpi/ic_launcher_round.xml
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Grant execute permission for gradlew
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: chmod +x gradlew
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Build Debug APK
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: ./gradlew assembleDebug
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Upload APK
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    uses: actions/upload-artifact@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  name: tiktok-downloader-debug.apk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          path: app/build/outputs/apk/debug/app-debug.apk
